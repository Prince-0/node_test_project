<!DOCTYPE html>
<html>
<head>
  <title>Fixed Slot Booking</title>
  <style>
    #popup {
      display: none;
      border: 1px solid #000;
      padding: 15px;
      width: 200px;
      background: #f2f2f2;
      position: fixed;
      top: 30%;
      left: 40%;
    }
  </style>
</head>
<body>

<h2>Available Time Slots</h2>
<ul id="slots"></ul>

<div id="popup">
  <h3>Book Slot</h3>
  <input type="text" id="name" placeholder="Your Name"><br><br>
  <input type="email" id="email" placeholder="Your Email"><br><br>
  <button onclick="submitBooking()">Submit</button>
  <button onclick="closePopup()">Cancel</button>
</div>

<script>
let selectedTime = null;

// ðŸ”¹ Load Slots
async function loadSlots() {
    const res = await fetch('/api/slots');   // âœ… FIXED
    const slots = await res.json();

    const ul = document.getElementById('slots');
    ul.innerHTML = '';

    for (let time in slots) {
        const li = document.createElement('li');
        li.innerHTML = `
            <b>${time}</b>
            (Available: ${slots[time].capacity - slots[time].booked})
            <button onclick="openPopup('${time}')">Book</button>
            <button onclick="cancelSlot('${time}')">Cancel</button>
        `;
        ul.appendChild(li);
    }
}

// ðŸ”¹ Open popup
function openPopup(time) {
    selectedTime = time;
    document.getElementById('popup').style.display = 'block';
}

// ðŸ”¹ Close popup
function closePopup() {
    document.getElementById('popup').style.display = 'none';
}

// ðŸ”¹ Submit booking
async function submitBooking() {
    const name = document.getElementById('name').value;
    const email = document.getElementById('email').value;

    if (!name || !email) {
        alert("Please fill all fields");
        return;
    }

    await fetch('/api/book', {   // âœ… FIXED
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ time: selectedTime, name, email })
    });

    closePopup();
    loadSlots();
}

// ðŸ”¹ Cancel slot
async function cancelSlot(time) {
    await fetch('/api/cancel', {   // âœ… FIXED
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ time })
    });
    loadSlots();
}

// initial load
loadSlots();
</script>

</body>
</html>